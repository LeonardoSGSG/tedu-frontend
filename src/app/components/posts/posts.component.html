<div class="container contenedormain">
  <p>
    <mat-toolbar class="container" id="toolbar2">
        <!--Dialog Crear Curso-->
        <div class="container">
          <button mat-raised-button (click)="popupCreate()">
            <mat-icon>add</mat-icon>Crear publicacion
          </button>
        </div>
    </mat-toolbar>
</p>
<!--Posts-->
<div class="row">
    <div *ngFor="let post of posts" layout-align="center center" class="contenedor">
        <mat-card class="box example-card row">
            <mat-card-header class="box-header">
            <div class="user-block">
                    <img class="img-circle" src=".\assets\img\user.png" alt="User Image">
                    <mat-card-title class="username">{{post.user.name}}</mat-card-title>
                    <mat-card-subtitle class="description">{{post.created | date:'medium'}}</mat-card-subtitle>
                </div>
                <div class="box-tools">
                    <button class="boton" *ngIf="post.user.id + '' == myId" (click)="popupUpdate(post.id+'')" mat-icon-button color="primary" data-original-title="Edit"><mat-icon>edit</mat-icon></button>
                    <button class="boton" *ngIf="post.user.id + '' == myId || myId == pId" (click)="eliminarPost(post.id)" mat-icon-button color="warn" data-original-title="Delete"><mat-icon >delete</mat-icon></button>
                </div>
            </mat-card-header>            
            <mat-card-content class="post-content">
                <p style="word-wrap: break-word;">{{post.text}}</p>                                                                                           
            </mat-card-content>                      
            <mat-card-actions align="end">
                <span class="pull-right text-muted"><a type="button" (click)="getComments(post.id+'')">Ver comentarios</a></span>
            </mat-card-actions>
            <!--comentarios del post-->
            <mat-card-content *ngIf="post.id+'' == idPost">
                <div *ngFor="let comment of comments">
                    <div class="post-comment">
                        <div class="box-footer box-comments">
                            <div class="box-comment">
                                    <span class="username">
                                        {{post.user.name}} &nbsp; <span class="fecha_coment">{{comment.created | date:'medium'}}</span>
                                        <a *ngIf="post.user.id + '' == myId" class="pull-right" mat-button [matMenuTriggerFor]="menu"><mat-icon>more_horiz</mat-icon></a>
                                        <mat-menu #menu="matMenu">
                                            <button (click)="editInputComment(comment.id)" mat-menu-item>Editar</button>
                                            <button (click)="deleteComment(post.id+'',comment.id)" mat-menu-item>Eliminar</button>                                            
                                        </mat-menu> 
                                    </span>
                                    <div *ngIf="shouldRun">
                                        <form  [formGroup]="editForm" class="mat-form-field" *ngIf="comment.id+'' == idComment">
                                            <mat-form-field appearance="outline">
                                                <input type="text" ngModel="{{comment?.text}}" name="text" formControlName="text" id="text" matInput>
                                            </mat-form-field>
                                            <div class="mt-3">                                                
                                                <button mat-button color="primary" (click)="editComment(editForm.value,post.id+'',comment.id)">Actualizar</button>&nbsp;
                                                <button mat-button (click)="cancelUpdate()">Cancelar</button>
                                            </div>
                                        </form>                                                                                                 
                                    </div>     
                                    <p *ngIf="comment.id+'' != idComment">{{comment.text}}</p>                                                                                                                        
                            </div>
                        </div>                                                                                  
                    </div>                   
                </div>                
            </mat-card-content>
            <mat-divider inset></mat-divider>
            <!--form enviar comentario-->
            <mat-card-footer>
                <div class="box-footer-form">                  
                  <form [formGroup]="addCommentForm" (ngSubmit)="postFormComment(addCommentForm.value,post.id+'')">
                    <div class="card-body form-group img-push">
                        <div>
                            <mat-form-field appearance="outline">
                                <mat-label>Escribe un comentario</mat-label>
                                <input matInput formControlName="text" name="text" type="text">
                            </mat-form-field>
                        </div>
                        <div>
                            <button class="btn-comentar pull-right" color="basic" (click)="postFormComment(addCommentForm.value,post.id+'')" mat-raised-button color="primary">
                                Comentar
                            </button>
                        </div>
                    </div>                            
                </form>
                </div>
            </mat-card-footer>
        </mat-card>
    </div>
</div>
</div>